---
import navigation from '../data/navigation.json';

const currentPath = Astro.url.pathname;

function isActive(href: string): boolean {
  if (href === '/') return currentPath === '/';
  return currentPath.startsWith(href);
}
---

<nav class="hidden md:flex items-center gap-8" aria-label="Main navigation">
  {navigation.mainNav.map((item) => (
    <div class="relative group">
      <a
        href={item.href}
        class:list={['nav-link', { 'nav-link-active': isActive(item.href) }]}
      >
        {item.label}
        {item.children && (
          <svg class="inline-block w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
          </svg>
        )}
      </a>

      {item.children && (
        <div class="absolute left-0 top-full pt-2 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50">
          <div class="bg-white rounded-lg shadow-lg border border-gray-100 py-2 min-w-[200px]">
            {item.children.map((child) => (
              <a
                href={child.href}
                class="block px-4 py-2 text-gray-600 hover:text-brand-600 hover:bg-gray-50 transition-colors"
              >
                <span class="font-medium">{child.label}</span>
                {child.description && (
                  <span class="block text-sm text-gray-400">{child.description}</span>
                )}
              </a>
            ))}
          </div>
        </div>
      )}
    </div>
  ))}
</nav>

<!-- Mobile Navigation -->
<nav id="mobile-nav" class="md:hidden hidden fixed inset-0 bg-white z-50" aria-label="Mobile navigation">
  <div class="flex justify-between items-center p-4 border-b border-gray-100">
    <a href="/" class="text-xl font-bold text-gray-900">Kady Dennis</a>
    <button id="close-mobile-nav" class="p-2" aria-label="Close menu">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
      </svg>
    </button>
  </div>

  <div class="p-4 space-y-4">
    {navigation.mainNav.map((item) => (
      <div>
        <a
          href={item.href}
          class:list={['block py-2 text-lg font-medium', isActive(item.href) ? 'text-brand-600' : 'text-gray-900']}
        >
          {item.label}
        </a>
        {item.children && (
          <div class="pl-4 space-y-2 mt-2">
            {item.children.map((child) => (
              <a
                href={child.href}
                class="block py-1 text-gray-600 hover:text-brand-600"
              >
                {child.label}
              </a>
            ))}
          </div>
        )}
      </div>
    ))}

    <div class="pt-4 border-t border-gray-100">
      <a href={navigation.cta.primary.href} class="btn btn-primary w-full">
        {navigation.cta.primary.label}
      </a>
    </div>
  </div>
</nav>

<script>
  const mobileNav = document.getElementById('mobile-nav');
  const openBtn = document.getElementById('open-mobile-nav');
  const closeBtn = document.getElementById('close-mobile-nav');

  openBtn?.addEventListener('click', () => {
    mobileNav?.classList.remove('hidden');
    document.body.style.overflow = 'hidden';
  });

  closeBtn?.addEventListener('click', () => {
    mobileNav?.classList.add('hidden');
    document.body.style.overflow = '';
  });
</script>
